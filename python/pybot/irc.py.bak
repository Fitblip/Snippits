#!/usr/bin/env python

import irclib, urllib, time, status, java, netsec, signal, sys, drunk, metasploit


network = 'irc.whyterabbit.net'
port = 9999
channel1 = '#main'
channel2 = '#whyte'
nick = 'Zer0-Bot'
name = 'Zer0 Bot'

class ClientClass ( irclib.SimpleIRCClient ):
		
#	def on_join   (self, connection, event):
#		channel = event.target()
#		time.sleep(2)
#		connection.privmsg(channel,"OOOH snap. It's the Zer0-Bot in the house! (try !status, !help, or !javabugs)")

	def on_pubmsg (self, connection, event):
		channel = event.target()
		dude    = event.source().split('!')[0]
		msg     = event.arguments()[0]
		if msg == '!status':
			messages = status.getstatus(3)
			for line in messages:
				connection.privmsg(channel,line)

		if '!status-ticket' in msg:
			messages = status.getticket(msg.split(' ')[1])
			for line in messages:
				if line != None:
					connection.privmsg(channel,line)

                if '!metasploit' in msg:
                    try:
                        day = int(msg.split(' ')[1]) + 1
                    except:
                        day = 1
                    message = metasploit.getstuffs(day)
                    for line in message:
                        connection.privmsg(channel,line)

		if msg == '!javabugs':
			messages = java.getbugs(3)
			for line in messages:
				connection.privmsg(channel,line)

		if msg == '!drunk':
			stat = drunk.isdrunk()
			if stat == True:
				connection.privmsg(channel,"Why yes, Ryan IS drunk!")
			if stat == False:
				connection.privmsg(channel,"Nope :(, Ryan isn't drunk...yet")

		if msg == '!netsec':
			messages = netsec.gettitles(3)
			for line in messages:
				connection.privmsg(channel,line)
		
		if msg == '!help':
			text = "Heyo " + dude + "! Try !drunk, !status, !status-ticket !javabugs, or !netsec :-D"
			connection.privmsg(channel,text)

#	def on_privmsg ( self, connection, event ):
#		connection.		

irc = ClientClass()
irc.connect(network, port, nick, ircname = name, ssl = True)
irc.connection.join(channel1)
irc.connection.join(channel2)
irc.start()



